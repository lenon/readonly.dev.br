<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to publish a blog on GitHub Pages with Hugo and GitHub Actions | readonly</title>
<meta name="title" content="How to publish a blog on GitHub Pages with Hugo and GitHub Actions" />
<meta name="description" content="I decided to start a new blog and, after looking at many of the available options for blogging, I chose a static site generator. I had used Jekyll in the past, but this time I wanted to try something new, so I gave Hugo a try. I also wanted to publish this blog to GitHub Pages whenever I push new content to the GitHub repo. So in this blog post I describe how I&rsquo;m using it along with GitHub actions to automatically deploy this blog to GitHub Pages." />
<meta name="keywords" content="hugo,blogging,github," />


<meta property="og:title" content="How to publish a blog on GitHub Pages with Hugo and GitHub Actions" />
<meta property="og:description" content="I decided to start a new blog and, after looking at many of the available options for blogging, I chose a static site generator. I had used Jekyll in the past, but this time I wanted to try something new, so I gave Hugo a try. I also wanted to publish this blog to GitHub Pages whenever I push new content to the GitHub repo. So in this blog post I describe how I&rsquo;m using it along with GitHub actions to automatically deploy this blog to GitHub Pages." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://readonly.dev.br/blog/how-to-publish-a-blog-on-github-pages-with-hugo-and-github-actions/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-10-25T21:00:00&#43;00:00" />
<meta property="article:modified_time" content="2020-10-25T21:00:00&#43;00:00" />




<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to publish a blog on GitHub Pages with Hugo and GitHub Actions"/>
<meta name="twitter:description" content="I decided to start a new blog and, after looking at many of the available options for blogging, I chose a static site generator. I had used Jekyll in the past, but this time I wanted to try something new, so I gave Hugo a try. I also wanted to publish this blog to GitHub Pages whenever I push new content to the GitHub repo. So in this blog post I describe how I&rsquo;m using it along with GitHub actions to automatically deploy this blog to GitHub Pages."/>



<meta itemprop="name" content="How to publish a blog on GitHub Pages with Hugo and GitHub Actions">
<meta itemprop="description" content="I decided to start a new blog and, after looking at many of the available options for blogging, I chose a static site generator. I had used Jekyll in the past, but this time I wanted to try something new, so I gave Hugo a try. I also wanted to publish this blog to GitHub Pages whenever I push new content to the GitHub repo. So in this blog post I describe how I&rsquo;m using it along with GitHub actions to automatically deploy this blog to GitHub Pages."><meta itemprop="datePublished" content="2020-10-25T21:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-10-25T21:00:00&#43;00:00" />
<meta itemprop="wordCount" content="797">
<meta itemprop="keywords" content="hugo,blogging,github," />
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  body {
    font-family: Verdana, sans-serif;
    margin: auto;
    padding: 20px;
    max-width: 720px;
    text-align: left;
    background-color: #fff;
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: #444;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  strong,
  b {
    color: #222;
  }

  a {
    color: #3273dc;
     
  }

  .title {
    text-decoration: none;
    border: 0;
  }

  .title span {
    font-weight: 400;
  }

  nav a {
    margin-right: 10px;
  }

  textarea {
    width: 100%;
    font-size: 16px;
  }

  input {
    font-size: 16px;
  }

  content {
    line-height: 1.6;
  }

  table {
    width: 100%;
  }

  img {
    max-width: 100%;
  }

  code {
    padding: 2px 5px;
    background-color: #f2f2f2;
  }

  pre code {
    color: #222;
    display: block;
    padding: 20px;
    white-space: pre-wrap;
    font-size: 14px;
  }

  div.highlight code {
    background-color: unset;
    color: inherit;
    white-space: pre;
    overflow-y: auto;
  }

  blockquote {
    border-left: 1px solid #999;
    color: #222;
    padding-left: 20px;
    font-style: italic;
  }

  footer {
    padding: 25px;
    text-align: center;
  }

  .helptext {
    color: #777;
    font-size: small;
  }

  .errorlist {
    color: #eba613;
    font-size: small;
  }

   
  ul.blog-posts {
    list-style-type: none;
    padding: unset;
  }

  ul.blog-posts li {
    display: flex;
  }

  ul.blog-posts li span {
    flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
    color: #8b6fcb;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #333;
      color: #ddd;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    strong,
    b {
      color: #eee;
    }

    a {
      color: #8cc2dd;
    }

    code {
      background-color: #777;
    }

    pre code {
      color: #ddd;
    }

    blockquote {
      color: #ccc;
    }

    textarea,
    input {
      background-color: #252525;
      color: #ddd;
    }

    .helptext {
      color: #aaa;
    }
  }

</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2 title="readonly">[ro]</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>How to publish a blog on GitHub Pages with Hugo and GitHub Actions</h1>
<p>
  <i>
    <time datetime='2020-10-25' pubdate>
      25 Oct, 2020
    </time>
  </i>
</p>

<content>
  <p>I decided to start a new blog and, after looking at many of the available
options for blogging, I chose a static site generator. I had used Jekyll in the
past, but this time I wanted to try something new, so I gave <a href="https://gohugo.io/">Hugo</a> a try.
I also wanted to publish this blog to GitHub Pages whenever I push new content
to the GitHub repo. So in this blog post I describe how I&rsquo;m using it along with
GitHub actions to automatically deploy this blog to GitHub Pages.</p>
<p>The first step is to declare a new workflow file for GitHub Actions. For this, I
added a new file in <code>.github/workflows/main.yml</code> with the following content:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Publish</span>
<span style="color:#f92672">on</span>: <span style="color:#ae81ff">push</span>
<span style="color:#f92672">jobs</span>:
  <span style="color:#f92672">deploy</span>:
    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
    <span style="color:#f92672">steps</span>:
      - <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v2</span>
        <span style="color:#f92672">with</span>:
          <span style="color:#f92672">submodules</span>: <span style="color:#66d9ef">true</span>
          <span style="color:#f92672">fetch-depth</span>: <span style="color:#ae81ff">0</span>

      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build and publish</span>
        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">./publish.sh</span>
</code></pre></div><p>This workflow is configured to run on every push to the repo (<code>on: push</code>). It
uses <code>actions/checkout</code> configured to also fetch submodules (<code>submodules: true</code>)
because Hugo themes are usually added as git submodules. The <code>fetch-depth</code>
option is configured with <code>0</code> to make it get all history for all branches and to
make possible to commit on the <code>gh-pages</code> branch.</p>
<p>Now the next step is to create the shell script referenced on the workflow file.
This script will build the static site, commit any changes and push them to the
repo. Here&rsquo;s how I started the <code>publish.sh</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>set -euxo pipefail
</code></pre></div><p>The first line makes the shell search for <code>bash</code> in user&rsquo;s <code>PATH</code>. It is more
flexible than using a hardcoded path. The second line makes bash a bit safer:</p>
<ul>
<li><code>set -e</code> stops the script if a command fails (when the exit status is greater
than 0).</li>
<li><code>set -u</code> tells Bash to treat unset variables as an error and exit immediately.</li>
<li><code>set -o pipefail</code> if any command in a pipeline fails, the entire pipe will
fail.</li>
<li><code>set -x</code> is good for debugging and is optional. It makes Bash print all
executed commands to the terminal.</li>
</ul>
<p>I use these 2 lines in almost all shell scripts that I write. Now let&rsquo;s see the
actual script.</p>
<p>As the virtual environment for GitHub Actions runner includes Snap, I used it to
install Hugo from the <a href="https://snapcraft.io/hugo">official package</a>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">sudo snap install hugo
</code></pre></div><p>Next, I added some commands for debugging:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">hugo env
hugo config
</code></pre></div><p>The first one prints Hugo version and environment info. Second one prints the
site configuration. They are useful for troubleshooting.</p>
<p>Then I used the following commands to build the site into a temporary folder:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">builddir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$RUNNER_TEMP<span style="color:#e6db74">/hugo-build&#34;</span>
mkdir -p <span style="color:#e6db74">&#34;</span>$builddir<span style="color:#e6db74">&#34;</span>
hugo --verbose --destination <span style="color:#e6db74">&#34;</span>$builddir<span style="color:#e6db74">&#34;</span>
</code></pre></div><p>To keep things simple, I decided to place static files in an orphan git branch.
With this type of branch, I can simply publish files in the root folder and
GitHub Pages will work right away. The only requirement is for the branch to be
named <code>gh-pages</code>.</p>
<p>Here&rsquo;s the command to create a new orphan branch or to switch to it when it
already exists:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#66d9ef">if</span> ! git show-ref --verify --quiet refs/remotes/origin/gh-pages ; <span style="color:#66d9ef">then</span>
  git switch --recurse-submodules --orphan gh-pages
<span style="color:#66d9ef">else</span>
  git switch --recurse-submodules --create gh-pages --track origin/gh-pages
<span style="color:#66d9ef">fi</span>
</code></pre></div><p>As I mentioned, the conditional will check if <code>gh-pages</code> already exists and, if
not, will create it as an orphan branch. Later on, the script will push this
branch to the repo. Otherwise, when it is not the first run (<code>gh-pages</code> was
already pushed), it will simply switch to it locally.</p>
<p>Now it is necessary to move static files to the repo. I used rsync for this
task:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">rsync --verbose <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --archive <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --delete <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --exclude .git <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --exclude CNAME <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#e6db74">&#34;</span>$builddir<span style="color:#e6db74">/&#34;</span> .
</code></pre></div><p>This command will add new files and remove stale ones. It is important to not
touch <code>.git</code> because it contains the actual git repo. <code>CNAME</code> should also not be
touched because GitHub Pages uses it to store custom domains.</p>
<p>Now, the last step:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash">git config user.name github-actions
git config user.email github-actions@github.com
git add -- .
git commit --allow-empty --message <span style="color:#e6db74">&#34;publish changes from commit </span>$GITHUB_SHA<span style="color:#e6db74">&#34;</span>
git push origin gh-pages
</code></pre></div><p>I included the <code>--allow-empty</code> flag because sometimes a change in source files
does not cause an actual change in the output of static files.</p>
<p>Let&rsquo;s see how the final script looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash
</span><span style="color:#75715e"></span>set -euxo pipefail

sudo snap install hugo

hugo env
hugo config

builddir<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;</span>$RUNNER_TEMP<span style="color:#e6db74">/hugo-build&#34;</span>
mkdir -p <span style="color:#e6db74">&#34;</span>$builddir<span style="color:#e6db74">&#34;</span>
hugo --verbose --destination <span style="color:#e6db74">&#34;</span>$builddir<span style="color:#e6db74">&#34;</span>

<span style="color:#66d9ef">if</span> ! git show-ref --verify --quiet refs/remotes/origin/gh-pages ; <span style="color:#66d9ef">then</span>
  git switch --recurse-submodules --orphan gh-pages
<span style="color:#66d9ef">else</span>
  git switch --recurse-submodules --create gh-pages --track origin/gh-pages
<span style="color:#66d9ef">fi</span>

rsync --verbose <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --archive <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --delete <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --exclude .git <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      --exclude CNAME <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#e6db74">&#34;</span>$builddir<span style="color:#e6db74">/&#34;</span> .

git config user.name github-actions
git config user.email github-actions@github.com
git add -- .
git commit --allow-empty --message <span style="color:#e6db74">&#34;publish changes from commit </span>$GITHUB_SHA<span style="color:#e6db74">&#34;</span>
git push origin gh-pages
</code></pre></div><p>You can see the up-to-date version of this script <a href="https://github.com/lenon/readonly.dev.br/blob/main/publish.sh">here on
GitHub</a>.</p>

</content>
<p>
  
  <a href="https://readonly.dev.br/tags/hugo/">#hugo</a>
  
  <a href="https://readonly.dev.br/tags/blogging/">#blogging</a>
  
  <a href="https://readonly.dev.br/tags/github/">#github</a>
  
</p>

  </main>
  <footer>
</footer>

    
</body>

</html>
